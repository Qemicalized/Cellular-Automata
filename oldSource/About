My initial modification of Ignotas code. Includes all comments and is onyl here should you find a 
use for it.